<div class="archivist-sync-content">
  <!-- Tab Navigation -->
  <nav class="tabs" data-group="main">
    <a class="item" data-tab="world">
      <i class="fas fa-globe"></i>
      {{localize "ARCHIVIST_SYNC.tabs.world"}}
    </a>
    <a class="item" data-tab="title">
      <i class="fas fa-edit"></i>
      {{localize "ARCHIVIST_SYNC.tabs.title"}}
    </a>
    <a class="item" data-tab="characters">
      <i class="fas fa-users"></i>
      {{localize "ARCHIVIST_SYNC.tabs.characters"}}
    </a>
  </nav>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- World Selection Tab -->
    <div class="tab" data-tab="world">
      <div class="form-group">
        <label>{{localize "ARCHIVIST_SYNC.labels.apiStatus"}}</label>
        <div class="api-status">
          {{#if isApiConfigured}}
          <span class="status-indicator connected">
            <i class="fas fa-check-circle"></i>
            {{localize "ARCHIVIST_SYNC.status.connected"}}
          </span>
          <small>{{localize "ARCHIVIST_SYNC.labels.apiKey"}}: {{apiKey}}</small>
          {{else}}
          <span class="status-indicator disconnected">
            <i class="fas fa-times-circle"></i>
            {{localize "ARCHIVIST_SYNC.status.notConfigured"}}
          </span>
          <small>{{localize "ARCHIVIST_SYNC.hints.configureApi"}}</small>
          {{/if}}
        </div>
      </div>

      {{#if isApiConfigured}}
      <div class="form-group">
        <button type="button" class="sync-worlds-btn" data-action="syncWorlds" {{#if isLoading}}disabled{{/if}}>
          {{#if isLoading}}
          <i class="fas fa-spinner fa-spin"></i>
          {{localize "ARCHIVIST_SYNC.buttons.syncing"}}
          {{else}}
          <i class="fas fa-sync"></i>
          {{localize "ARCHIVIST_SYNC.buttons.syncWorlds"}}
          {{/if}}
        </button>
      </div>

      {{#if worlds.length}}
      <div class="form-group">
        <label for="world-select">{{localize "ARCHIVIST_SYNC.labels.selectWorld"}}</label>
        <select id="world-select" name="worldSelect" data-action="worldSelectChange">
          <option value="">{{localize "ARCHIVIST_SYNC.options.selectWorld"}}</option>
          {{#each worlds}}
          <option value="{{this.id}}" {{#if (eq this.id ../selectedWorldId)}}selected{{/if}}>
            {{this.name}}
          </option>
          {{/each}}
        </select>
      </div>

      <div class="form-group">
        <button type="button" class="save-selection-btn" data-action="saveWorldSelection" id="save-selection" disabled>
          <i class="fas fa-save"></i>
          {{localize "ARCHIVIST_SYNC.buttons.saveSelection"}}
        </button>
      </div>
      {{/if}}

      {{#if isWorldSelected}}
      <div class="current-selection">
        <h4>{{localize "ARCHIVIST_SYNC.labels.currentSelection"}}</h4>
        <p><strong>{{selectedWorldName}}</strong> (ID: {{selectedWorldId}})</p>
      </div>
      {{/if}}
      {{/if}}
    </div>

    <!-- World Details Tab -->
    <div class="tab" data-tab="title">
      {{#if isWorldSelected}}
      <div class="world-details-container">
        <!-- Foundry World Section -->
        <div class="world-section foundry-section">
          <div class="section-header">
            <h4><i class="fas fa-desktop"></i> {{localize "ARCHIVIST_SYNC.labels.foundryWorld"}}</h4>
          </div>
          <div class="world-data-box">
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.title"}}:</label>
              <div class="field-value">{{foundryWorldTitle}}</div>
            </div>
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.description"}}:</label>
              <div class="field-value description-field">{{foundryWorldDescription}}</div>
            </div>
          </div>
          <div class="sync-controls">
            <button type="button" class="sync-to-archivist-btn" data-action="syncToArchivist" {{#if
              syncInProgress}}disabled{{/if}}>
              {{#if syncInProgress}}
              <i class="fas fa-spinner fa-spin"></i>
              {{localize "ARCHIVIST_SYNC.buttons.syncing"}}
              {{else}}
              <i class="fas fa-arrow-right"></i>
              {{localize "ARCHIVIST_SYNC.buttons.syncFromFoundry"}}
              {{/if}}
            </button>
          </div>
        </div>

        <!-- Sync Arrow -->
        <div class="sync-divider">
          <div class="sync-arrows">
            <i class="fas fa-exchange-alt"></i>
          </div>
        </div>

        <!-- Archivist World Section -->
        <div class="world-section archivist-section">
          <div class="section-header">
            <h4><i class="fas fa-cloud"></i> {{localize "ARCHIVIST_SYNC.labels.archivistWorld"}}</h4>
          </div>
          <div class="world-data-box">
            {{#if selectedWorldData}}
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.title"}}:</label>
              <div class="field-value">{{selectedWorldData.title}}</div>
            </div>
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.description"}}:</label>
              <div class="field-value description-field">{{selectedWorldData.description}}</div>
            </div>
            {{#if selectedWorldData.lastUpdated}}
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.lastUpdated"}}:</label>
              <div class="field-value">{{selectedWorldData.lastUpdated}}</div>
            </div>
            {{/if}}
            {{#if selectedWorldData.createdAt}}
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.createdAt"}}:</label>
              <div class="field-value">{{selectedWorldData.createdAt}}</div>
            </div>
            {{/if}}
            {{#if selectedWorldData.characterCount}}
            <div class="world-field">
              <label>{{localize "ARCHIVIST_SYNC.labels.characterCount"}}:</label>
              <div class="field-value">{{selectedWorldData.characterCount}}</div>
            </div>
            {{/if}}
            {{else}}
            <div class="info">
              <p>{{localize "ARCHIVIST_SYNC.messages.loadingWorldData"}}</p>
            </div>
            {{/if}}
          </div>
          <div class="sync-controls">
            <button type="button" class="sync-from-archivist-btn" data-action="syncFromArchivist" {{#if
              syncInProgress}}disabled{{/if}}>
              {{#if syncInProgress}}
              <i class="fas fa-spinner fa-spin"></i>
              {{localize "ARCHIVIST_SYNC.buttons.syncing"}}
              {{else}}
              <i class="fas fa-arrow-left"></i>
              {{localize "ARCHIVIST_SYNC.buttons.syncFromArchivist"}}
              {{/if}}
            </button>
          </div>
        </div>
      </div>

      <div class="sync-info">
        <div class="current-target">
          <h4>{{localize "ARCHIVIST_SYNC.labels.syncTarget"}}</h4>
          <p><strong>{{selectedWorldName}}</strong> ({{selectedWorldId}})</p>
        </div>
      </div>
      {{else}}
      <div class="warning-message">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{localize "ARCHIVIST_SYNC.warnings.selectWorldFirst"}}</p>
      </div>
      {{/if}}
    </div>

    <!-- Character Mapping Tab -->
    <div class="tab" data-tab="characters">
      {{#if isWorldSelected}}
      <div class="characters-section">
        <!-- Player Characters Section -->
        <div class="character-type-section">
          <h4><i class="fas fa-user"></i> {{localize "ARCHIVIST_SYNC.labels.playerCharacters"}}</h4>
          {{#if playerCharacters.length}}
          <div class="actors-list player-characters">
            {{#each playerCharacters}}
            <div class="actor-item">
              <div class="actor-info">
                <img src="{{this.img}}" alt="{{this.name}}" class="actor-avatar">
                <div class="actor-details">
                  <h5>{{this.name}}</h5>
                  <p class="actor-type">{{this.type}}</p>
                  {{#if this.truncatedDescription}}
                  <p class="actor-description">{{this.truncatedDescription}}</p>
                  {{/if}}
                </div>
              </div>
              <div class="actor-status">
                {{#if this.loadingStatus}}
                <div class="sync-status-indicator loading">
                  <i class="fas fa-spinner fa-spin"></i>
                  Loading...
                </div>
                {{else if this.existsInArchivist}}
                <div class="sync-status-indicator exists">
                  <i class="fas fa-check-circle"></i>
                  {{localize "ARCHIVIST_SYNC.labels.existsInArchivist"}}
                </div>
                {{else}}
                <div class="sync-status-indicator not-exists">
                  <i class="fas fa-times-circle"></i>
                  {{localize "ARCHIVIST_SYNC.labels.notInArchivist"}}
                </div>
                {{/if}}
                <div class="actor-actions">
                  {{#if this.existsInArchivist}}
                  <button type="button" class="map-character-btn" data-actor-id="{{this.id}}">
                    <i class="fas fa-link"></i>
                    {{localize "ARCHIVIST_SYNC.buttons.map"}}
                  </button>
                  {{else}}
                  <button type="button" class="create-character-btn" data-actor-id="{{this.id}}">
                    <i class="fas fa-plus"></i>
                    {{localize "ARCHIVIST_SYNC.buttons.create"}}
                  </button>
                  {{/if}}
                </div>
              </div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <p class="no-actors">{{localize "ARCHIVIST_SYNC.messages.noPlayerCharacters"}}</p>
          {{/if}}
        </div>

        <!-- NPCs Section -->
        <div class="character-type-section">
          <h4><i class="fas fa-users"></i> {{localize "ARCHIVIST_SYNC.labels.npcs"}}</h4>
          {{#if npcs.length}}
          <div class="actors-list npcs">
            {{#each npcs}}
            <div class="actor-item">
              <div class="actor-info">
                <img src="{{this.img}}" alt="{{this.name}}" class="actor-avatar">
                <div class="actor-details">
                  <h5>{{this.name}}</h5>
                  <p class="actor-type">{{this.type}}</p>
                  {{#if this.truncatedDescription}}
                  <p class="actor-description">{{this.truncatedDescription}}</p>
                  {{/if}}
                </div>
              </div>
              <div class="actor-status">
                {{#if this.loadingStatus}}
                <div class="sync-status-indicator loading">
                  <i class="fas fa-spinner fa-spin"></i>
                  Loading...
                </div>
                {{else if this.existsInArchivist}}
                <div class="sync-status-indicator exists">
                  <i class="fas fa-check-circle"></i>
                  {{localize "ARCHIVIST_SYNC.labels.existsInArchivist"}}
                </div>
                {{else}}
                <div class="sync-status-indicator not-exists">
                  <i class="fas fa-times-circle"></i>
                  {{localize "ARCHIVIST_SYNC.labels.notInArchivist"}}
                </div>
                {{/if}}
                <div class="actor-actions">
                  {{#if this.existsInArchivist}}
                  <button type="button" class="map-character-btn" data-actor-id="{{this.id}}">
                    <i class="fas fa-link"></i>
                    {{localize "ARCHIVIST_SYNC.buttons.map"}}
                  </button>
                  {{else}}
                  <button type="button" class="create-character-btn" data-actor-id="{{this.id}}">
                    <i class="fas fa-plus"></i>
                    {{localize "ARCHIVIST_SYNC.buttons.create"}}
                  </button>
                  {{/if}}
                </div>
              </div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <p class="no-actors">{{localize "ARCHIVIST_SYNC.messages.noNpcs"}}</p>
          {{/if}}
        </div>

        <div class="form-group bulk-actions">
          <button type="button" class="sync-characters-btn" data-action="syncCharacters" {{#if
            syncInProgress}}disabled{{/if}}>
            {{#if syncInProgress}}
            <i class="fas fa-spinner fa-spin"></i>
            {{localize "ARCHIVIST_SYNC.buttons.syncing"}}
            {{else}}
            <i class="fas fa-users"></i>
            {{localize "ARCHIVIST_SYNC.buttons.syncCharacters"}}
            {{/if}}
          </button>
        </div>
      </div>
      {{else}}
      <div class="warning-message">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{localize "ARCHIVIST_SYNC.warnings.selectWorldFirst"}}</p>
      </div>
      {{/if}}
    </div>
  </div>
</div>